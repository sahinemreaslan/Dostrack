# DOSTrack Adaptive Configuration
# Dynamic template and search region sizing based on object characteristics
# Designed to handle occlusion, scale changes, and out-of-view scenarios

DATA:
  MAX_SAMPLE_INTERVAL: 200
  MEAN:
  - 0.485
  - 0.456
  - 0.406
  STD:
  - 0.229
  - 0.224
  - 0.225

  # Adaptive sizing strategy
  ADAPTIVE:
    ENABLED: True
    # Template sizing based on object size
    TEMPLATE_SIZES: [64, 128, 224, 384]  # Available template sizes
    SEARCH_FACTORS: [3.0, 2.0, 2.0, 2.0]  # Search factor for each template size
    # Object size thresholds (in pixels)
    SIZE_THRESHOLDS: [50, 150, 300]  # Small, Medium, Large thresholds

    # Template update strategy
    TEMPLATE_UPDATE:
      ENABLED: True
      CONFIDENCE_THRESHOLD: 0.85  # Update only if confidence > threshold
      UPDATE_INTERVAL: 5  # Update every N frames if conditions met
      BANK_SIZE: 5  # Number of templates to keep in memory
      EMA_ALPHA: 0.1  # Exponential moving average weight

    # Search region expansion based on confidence
    SEARCH_EXPANSION:
      ENABLED: True
      HIGH_CONF_FACTOR: 2.0   # confidence > 0.8
      MED_CONF_FACTOR: 3.0    # 0.5 < confidence < 0.8
      LOW_CONF_FACTOR: 5.0    # confidence < 0.5
      CONFIDENCE_THRESHOLDS: [0.5, 0.8]

  # Default values (will be overridden by adaptive sizing during runtime)
  SEARCH:
    CENTER_JITTER: 3
    FACTOR: 2.0  # Base search factor
    SCALE_JITTER: 0.25
    SIZE: 224  # Base search size (will adapt)
    NUMBER: 1

  TEMPLATE:
    CENTER_JITTER: 0
    FACTOR: 2.0
    SCALE_JITTER: 0
    SIZE: 128  # Base template size (will adapt)

  TRAIN:
    DATASETS_NAME:
    - LASOT
    - GOT10K_vottrain
    - COCO17
    - TRACKINGNET
    DATASETS_RATIO:
    - 1
    - 1
    - 1
    - 1
    SAMPLE_PER_EPOCH: 60000

  VAL:
    DATASETS_NAME:
    - GOT10K_votval
    DATASETS_RATIO:
    - 1
    SAMPLE_PER_EPOCH: 10000

MODEL:
  PRETRAIN_FILE: "dinov3_vits16_pretrain.pth"
  EXTRA_MERGER: False
  RETURN_INTER: False

  BACKBONE:
    TYPE: dinov3_vits16  # DINOv3-Small for efficiency
    STRIDE: 16
    FROZEN: True  # Frozen backbone for fast training
    # No Candidate Elimination - fully dynamic approach

  HEAD:
    TYPE: TrulyDynamicCenterPredictor  # Dynamic head for variable sizes
    NUM_CHANNELS: 256

    # Quality assessment for template update
    QUALITY_ASSESSMENT:
      ENABLED: True
      OCCLUSION_THRESHOLD: 0.3
      SIZE_VARIANCE_THRESHOLD: 0.2

TRAIN:
  BACKBONE_MULTIPLIER: 0.0  # Frozen backbone
  DROP_PATH_RATE: 0.0

  BATCH_SIZE: 64  # Can use larger batch with Small model
  EPOCH: 300

  # Loss weights
  GIOU_WEIGHT: 2.0
  L1_WEIGHT: 5.0
  GRAD_CLIP_NORM: 0.1

  # Optimizer settings
  LR: 0.001  # Higher LR for head-only training
  LR_DROP_EPOCH: 240
  NUM_WORKER: 10
  OPTIMIZER: ADAMW
  WEIGHT_DECAY: 0.0001

  PRINT_INTERVAL: 50
  VAL_EPOCH_INTERVAL: 20
  AMP: False

  SCHEDULER:
    TYPE: step
    DECAY_RATE: 0.1

TEST:
  EPOCH: 300

  # These will be dynamically adjusted during tracking
  TEMPLATE_FACTOR: 2.0
  TEMPLATE_SIZE: 128
  SEARCH_FACTOR: 2.0
  SEARCH_SIZE: 224

  # Adaptive testing parameters
  ADAPTIVE:
    ENABLED: True
    # Multi-scale search when object is lost
    MULTI_SCALE_SEARCH:
      ENABLED: True
      LOST_THRESHOLD: 0.3  # Consider lost if confidence < threshold
      SCALES: [384, 512, 768]  # Pyramid search scales
      MAX_ATTEMPTS: 3  # Number of re-detection attempts
